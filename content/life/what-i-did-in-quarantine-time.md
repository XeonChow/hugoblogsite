---
title: 疫情期间不务正业的折腾记录
date: 2020-04-20T16:24:46+08:00
draft: false
slug: what-i-did-in-quarantine-time
tags: ["quarantine", "diy", "hardware"]
indent: true
dropCap: true
comments: true
toc: false
mathjax: false
---

由于突如其来的疫情，我拥有了人生最长的一个假期，比高考完的暑假还要长。再过几天终于可以返校了，很惭愧，在家这么久，学术什么的全部抛到了脑后，不务正业的事情倒是干了不少。趁着这开学前的几天，记录一下在家都不务正业地折腾了些啥，也给自己收收心，做好开学后认真科研的心理准备。

<!--more-->

## 科学上网大升级

在除夕夜时，我用来科学上网的 VPS 的 IP 被封，这种事情当然不是第一次发生，甚至有点见怪不怪了。熟练地切换上另一台备用的 VPS，登陆被封的搬瓦工 VPS 后台，花上 10 刀更换了一个新的 IP。熟练地用一键脚本在 VPS上重新部署 SSR，这些操作已经做过无数次，可以说是轻车熟路了。

上网搜了一圈，在除夕这个时间点被封 IP 的人有不少，也许是网络防疫的要求吧（手动滑稽），毕竟在各种特殊时期，GFW 便会开启疯狂的封 IP 行动。但是老这么封 IP 再花钱换 IP 也不是长久之计，花冤枉钱不说，每次都重新配置一遍 VPS 也挺麻烦的。于是继续搜索，目前什么样的科学上网方式最为安全。好在 YouTube 上教你部署科学上网服务的教程一抓一大把，统统视频教学，可谓保姆级贴心，尽管「在墙外教你如何翻墙」听起来有点脱裤子放屁的感觉，但显然这的确是个重要需求，养活了大批华人 YouTuber。

目前公认比较安全的科学上网方式有两种：V2ray 和 Trojan。曾经流行的 SS 和 SSR 据说都被 GFW 识别出流量特征了，很容易被封。V2ray 我早就听过，之前也用一键脚本一路 default 选项部署过，但是使用起来感觉网速下降很大且非常不稳定，于是放弃了。

这次看来还是得捡起 V2ray，跟着一个叫 [波仔](https://www.youtube.com/channel/UCoHcnzcwjsFRUi6SkKq7Gbg) 的 YouTuber 的教程，先是用宝塔面板 + V2ray+ws+Nginx 的方法（具体教程见[这里](https://www.v2rayssr.com/v2raybaota.html)），将 V2ray 伪装在 Nginx 的网页服务里，申请一个域名并生成一个伪装网页，浏览器访问域名时显示伪装网页，V2ray 客户端访问时才转发给 V2ray，这样相当于把科学上网的流量伪装成 https 流量，并且如果 GFW 进行主动嗅探也会发现我部署的伪装网页，应该是目前相当安全的配置方法了。

以上方法操作起来不麻烦，但是由于需要在 VPS 上安装宝塔面板，对服务器的性能要求比较高。后来我又根据波仔的另一个教程，部署了 Trojan。原理和以上方法类似，也是将科学上网流量伪装成 https流量，只不过 Trojan 相比于 V2ray 更加轻量一些，具体教程可以看[这里](https://www.youtube.com/watch?v=ozY_5J23okY)。

即便如此，我感觉我科学上网速度下降地还是很厉害。我在学校时 YouTube 看 1080P 基本流畅，在家就常常会卡顿，时快时慢，也许和我更换 IP 有关。我的主力 VPS 是搬瓦工洛杉矶机房的 cn2 gt 线路，似乎是去程 cn2 线路、回程普通线路，所以到了晚高峰时段速度常常爆照。目前公认最好的线路是 cn2 gia 线路，来回都是 cn2，但是贵，搬瓦工最便宜的一年也得一两百刀。在不断学习科学上网知识时，发现大家说谷歌云的港台机房连接速度很快，并且谷歌云有第一年免费 300 刀的新人优惠，一般来说足够用满一年。免费的羊毛怎么能不薅呢？立马注册了谷歌云，绑定信用卡，获得了 300 刀的赠金。按网上教程，选择了台湾的机房，部署上 Trojan，结果你猜如何？BOOM，是我从未感受过的超快速度，SpeedTest 测速有 50mbps，YouTube 播放轻松 2-3 万 kbps，4K 流畅播放无压力，8K 也不是大问题（如果不心疼谷歌云赠金的话），并且即便出口宽带爆炸的晚上，YouTube 也能有 8000 到 1 万 kbps 的速度，1080P 还是轻轻松松的。

<img src="/what-i-did-in-quarantine-time/speed.png" width="500"  title="YouTube 连接速度">

于是谷歌云成为了我现在主力的 VPS，便宜（免费）的反而更好用，没想到世界上真的有这么天上掉馅饼的事情，从此对谷歌的爱又多了 100 分。并且据说谷歌云的 300 美元赠金到期后是有办法循环领取的，相当于可以一直白嫖下去，难道谷歌的本质其实是慈善公司？

## 这块板子其实是一台电脑

由于科学上网的需求，我几年前就接触了大多数人很少直接用到的 Linux 系统，并且学习了一些简单的 Linux 知识，比如如何 SSH 连接啦，如何用 apt-get 安装一些应用什么的。当然基本都只是略微知道而已，大多数时候就是跟着网上的教程一步一步来，万一一步出错，自己是没有什么解决能力的，也懒得 troubleshooting，就直接重装系统再来一遍。

很早之前就知道树莓派这个东西，知道它虽然便宜、小巧，但完全可以作为一台 PC 使用。闲在家里无事可做时，就想到，一般来说树莓派运行的是 Linux 系统，很适合作为低成本学习 Linux 系统的工具。毕竟之前配置科学上网服务常常遇到各种问题，由于对 Linux 各种命令缺乏了解，只能依赖各种一件脚本来配置，一旦出错就不知所措。买一台树莓派，随便怎么折腾也不会影响我用来科学上网的 VPS，而且放在本地局域网里连接更加方便，也能实现很多远程的 VPS 难以实现的功能。

买之前对树莓派进行了一番搜索，好在作为最流行的单板电脑（Single Board Computer, SBM），玩树莓派的人不少，相关社区和教程也很完善，因此很适合小白学习使用。除了作为一台基于 ARM 的 SMB，树莓派最令人称道的是拥有非常丰富的 I/O 接口和 GPIO 接口。尤其是 GPIO 接口，让树莓派有着惊人的扩展能力，可以外接各种各样的硬件，对硬件进行控制。比方说，用树莓派外接摄像头进行图像识别，外接机器人进行控制等等。但目前我对树莓派的需求仅仅是作为一台 Linux 服务器而已，关于 GPIO 的扩展应用暂时没有需求。

目前树莓派已经出到了第四代，处理性能相比于前代提升很高（当然还是远远逊色于大多数基于 X86 的电脑），可选最高 4GB 内存的版本，换装了千兆网卡，拥有两个 mini HDMI 接口，官方宣称能够支持外接两台 4K 显示器（没试过也没必要）。本着一步到位的原则，直接买了最高配置的 4GB 内存版 4B+（后来发现其实没必要），连同散热片、风扇、塑料外壳、usb-c连接线和 mini HDMI to HDMI 连接线，总共花了 ￥450 左右，确实很便宜（但后来我接触到各种矿渣产品，才知道啥叫真正的便宜）。

树莓派买回家以后，爸妈问我这是啥，我说别看这只是一块小小的电路板，它其实是一台完整的电脑。我妈表示非常惊讶，说她要是在马路上见到这个，一定会以为是块电子垃圾。但我爸还是发出了由衷的慨叹：「不得不相信，现在科技多发达。」我没告诉他的是他手里的手机其实比这玩意儿发达多了。

<img src="/what-i-did-in-quarantine-time/pi.jpg" width="500"  title="树莓派的本体">

树莓派到手以后很兴奋，跟着网上的视频教程，一步一步配置起来。我安装的是树莓派官方为树莓派定制的带图形界面的 Raspbian 系统，安装起来很方便，只要将系统镜像下载下来，烧录到存储卡中，插进树莓派后通电启动即可。初次使用树莓派要配置一下网络，使得树莓派和电脑在同一个局域网内，这样才能通过 SSH 或远程桌面访问到树莓派。

我的目的是让树莓派成为一个家庭影音服务器，于是在树莓派上安装了 Samba 文件共享服务和 Aria2 下载程序，并且挂载了一块移动硬盘作为外接存储。这样可以实现局域网内任何一个终端（无论是电脑、手机、平板还是电视盒子）都可以访问播放树莓派上的媒体资源，并且可以登录到 Aria2 的 WebUI 提交下载任务让树莓派挂机下载。为了方便在外网下也能访问树莓派并提交下载任务，我还安装了 Frp 内网穿透服务，用我的 VPS 作为反向代理服务器在外网访问树莓派。

然而在家庭局域网内播放树莓派上的视频时，我发现竟然常常卡顿，估计是因为家里的路由器都是百兆口的，理论最大的内网传输速度也不过 10 MBps，在播放码率比较高的视频时，或内网有其他设置占用较高带宽时（比如有设备在 BT 下载），当然会出现卡顿。于是便着手对家庭网络设备进行升级。

## 家庭网络大升级

家里的宽带是电信 100 兆宽带，并且加装了一个 IPTV。这个宽带日常使用已经足够了，尤其对于爸妈来说，对带宽的要求不高，因此家里的路由器也就一直使用的几年前的几个百兆路由器，一直没有换。

家庭的网络结构是这样的：弱电箱里光纤入户接运营商的光猫，光猫网络桥接模式，接一根网线到弱电箱里的主路由器 WAN 口；主路由器进行 PPPOE 拨号，并且开启 DHCP 为其他设备分配 IP，三个 LAN 口通过墙内布置的网线接到客厅和两个卧室的网口；客厅和两个卧室各有一个路由器作为无线 AP 使用，均关闭 DHCP 以使得所有设备都处于同一局域网。

然而无论是弱电箱里的主路由还是各个房间的无线路由器，都是几年前买的百兆路由器。很显然，这些路由器成为了局域网传输速度瓶颈，需要全部换掉。经过一番搜索，我选定了 TP-LINK 的 R470P 作为主路由，以及三个 TP-LINK 的 WDR7650 作为房间里的无线路由器。

选择 R470P 作主路由的原因是它体积小巧，并且是铁外壳利于散热，适合放在狭小的弱电箱内。并且这款路由器没有无线功能（放在弱电箱里也不需要），官方宣称是企业级的（我就当他是吧），应该比较稳定不易出问题。毕竟是家庭主路由，我不在家时爸妈使用最好不要掉链子，不然出问题了没人解决。并且这个路由器其实是支持 POE 的，所谓 POE 即「Power Over Ethernet」，可以通过网线供电，因此它其实可以搭配 AP 面板（就像插座面板一样，但可以作为无线网络接入点），代替掉房间需要外接电源的路由器，提供如同商场等公共场所那种无处不在且无缝的无线网络漫游体验。但是由于成本问题（AP 面板价格还是太高）以及每个房间还是需要多个有线网口接其他网络设备，我还是放弃选择 AP 面板方案。

而房间里选择的这三个一模一样的 WDR7650，是目前非常热门的廉价 MESH 路由器，TP-LINK 官方起名为「易展」路由器。只要配置好一个易展路由器，然后按下其他易展路由器上的易展键即可开启自动的 MESH 组网。所谓 MESH 组网，可以简单理解为，几个路由器有着相同的无线名称和密码，并且可以让设备自动连接附近信号最好的那个路由器，以实现在家庭内不同位置无线网的无缝漫游。

在研究各种路由器的过程中，一个新的名词出现了，那就是「软路由」。这也开启了我假期的另一个折腾内容——矿渣产品。

## 矿渣初体验——N1 盒子

在 YouTube 上学习科学上网知识时，常常听到 up 主们提到软路由这个东西。所谓的软路由，区别于传统不能刷系统的成品硬件路由器，可以刷其他系统，以实现传统路由器无法实现的功能。比方说，在软路由系统安装科学上网插件，就可以避免在每个客户端安装代理软件，只要连接了局域网，就可以直接科学上网；再比方说，安装去广告插件，则可以在连接局域网上网时，减少网页和应用里的广告。以上只是软路由众多功能的冰山一角。

软路由的形态多种多样，一些传统路由器厂商，比如华硕和网件，会出一些处理器硬件性能很好的路由器，就有第三方为这些路由器编写功能丰富的固件，比如知名的华硕梅林固件。这种能刷写第三方固件的传统路由器也能算作软路由，但毕竟传统路由器看重的是网络性能而非软件功能，处理器硬件性能一般偏低，而高性能则意味着价格也高上许多。因此除了一些智能硬件厂商出的路由器（比如小米、极路由和下文主角——斐讯），廉价的软路由基本都要靠 DIY。

理论上，只要有网口网卡，有处理器和内存，有适配的软路由系统，一台设备就可以成为软路由。比如闲置的笔记本电脑、台式机甚至上文提到的树莓派，都可以刷上系统成为软路由。但考虑到成本和便利，一台适合做软路由的矿渣产品映入眼帘，没错，它就是已倒闭的著名 P2P 金融硬件公司斐讯的 N1 盒子。

<img src="/what-i-did-in-quarantine-time/n1.jpg" width="500"  title="这个盒子长这样">

关于斐讯公司我就不展开介绍了，这是一家神奇的公司，也是一家让我感到惋惜的公司。尽管它在 P2P 金融和加密货币圈钱大潮后毫不意外地轰然倒塌，但我相信，它当时要是愿意老老实实做产品，说不定也能在智能硬件领域活下去并且活得很好。惋惜归惋惜，它要是不倒闭，我这会儿也没法低价捡垃圾。斐讯有很多知名产品，比如 K 系列的智能路由器，硬件参数远高于同价位（当然花成千上万买 P2P 产品然后爆雷血本无归的人另当别论）的传统厂商路由器，也有很多人买来做软路由。而我选择的 N1 盒子，斐讯官方给他的全名是「斐讯天天链N1——新一代专业家庭 NAS 云盘」，当初官方定位是能挖矿的家庭 NAS（当时买的人主要是为了挖矿赚钱），斐讯倒闭以后矿也没得挖了，大量的二手矿渣 N1 盒子就流入了市场。去年初斐讯刚刚爆雷的时候，闲鱼上购买一个 N1 盒子只要不到 50 元，跟白捡一样（我年初入手价格已经差不多 100 块了）。

斐讯的硬件参数不错，晶晨 Amlogic S905D 处理器（一般高端一点的电视盒子才用这个），2G RAM，8G ROM，支持 4K@60fps H265/VP9 10bit硬件解码。有两个 USB 2.0 接口，一个 HDMI 接口和一个千兆网口。说了这么多，这个机顶盒一样的盒子到底能干啥？由于民间大神众多，硬是把这个盒子玩出了花儿。以下简单罗列以下我知道的 N1 盒子能刷的系统和实现的功能：

1. 刷 OpenWrt 成为软路由；
2. 刷 Android TV 成为电视盒子（人家确实能当机顶盒呢）；
3. 刷 CoreELEC 系统成为蓝光多媒体播放终端（还是电视盒子，不过精简为一个 Kodi 系统，播放性能更好）；
4. 刷 EmuELEC 系统成为复古游戏主机；
5. 刷小钢炮系统成为 NAS 和下载机；
6. 刷 Armbian 成为一个 Linux 主机（也就是树莓派能干的他一般也都能干，树莓派哭泣）。

总之得益于低廉的售价和相对强大的性能，这一个盒子硬是被玩成了瑞士军刀。

我一开始刷了 OpenWrt 系统作软路由，恩山论坛有大量适配 N1 盒子的固件和保姆级的刷机教程，我选用的是 Flippy 大神编译的 OpenWrt 固件，相关帖子见[这里](https://www.right.com.cn/forum/thread-981406-1-1.html)。由于只有单网卡，且无线性能相当垃圾，N1 盒子适合作为网关路由器、即所谓的「旁路由」使用。这样拨号和 DHCP 和无线等功能依然由其他网络处理性能更好的传统路由器完成，N1 盒子连接到主网络下成为一个网关服务器，别的设备可以手动把网关改为 N1 盒子的 IP，从而使用 N1 上配置的各种功能。我对软路由的需求主要只有科学上网，于是在 N1 上安装科学上网插件以后，我的手机和电脑在局域网下也可以直接科学上网了。

后来我又买了一个矿渣产品，并在这个产品上布置了科学上网服务（下文会讲），于是 N1 盒子又被我刷上了 CoreELEC 成为蓝光播放器。所谓的 CoreELEC 其实就是知名的播放软件 Kodi 放大成为一个系统，功能上和 Kodi 一模一样。我主要用它连接家里的电视，播放局域网内的媒体内容。Kodi 的玩法也很多，这里就不展开了。

这里讲一个意外发现，N1 作为电视盒子，有一个不方便的地方就是没有遥控器。一开始我在 USB 2.0 接口上插了一个无线飞鼠的接收器，把无线飞鼠当作遥控器使用。后来我偶然发现，家里索尼电视的遥控器竟然可以直接遥控 N1 盒子，让我十分惊讶。经过搜索才知道，这是因为索尼电视支持 HDMI CEC 控制，这样就可以通过索尼的遥控器遥控用 HDMI 连接到电视的设备。当然这个功能也需要连接到电视上的设备支持，显然 N1 是支持的。于是就这样，N1 盒子成为了一个完美的机顶盒。

## 年轻人的第一台 NAS（和第二台矿渣）

N1 盒子带我走进了矿渣产品的世界，让我领略了捡垃圾的乐趣，在深入了解矿渣产品的过程中，另一个矿渣产品又走进我的视野，它就是——蜗牛星际。

讲它之前先简单讲讲什么是 NAS。NAS 这个名字相信很多人都听过，那么 NAS 有什么用呢？今天小编就带大家了解一下 NAS 的作用。NAS 就是 Net Attached Storage。原来这就是 NAS，真的很神奇呢。大家有什么想法，欢迎留言和小编一起讨论哦。（营销号滚出去）

好了言归正传，NAS 正如其名 Net Attached Storage 的意思，只要是连接了网络的存储设备就可以算作是 NAS。但通常我们所说的 NAS 一般指有着专门文件管理系统的网络存储硬件，它确实可以当做是一块连着网的硬盘，但这个硬盘通常有着专门的系统以实现各种专业的文件管理功能。比如 NAS 可以创建磁盘阵列，支持多种文件系统，可以进行文件的实时备份和增量备份等功能。

成品 NAS 厂商，最知名的莫过于群晖了，他家的产品拥有成熟的系统和丰富易用的软件以及不错的稳定性，但缺点就是硬件性能较弱且价格高昂，x86 架构的产品起步就是上千。而我选择的这个矿渣产品蜗牛星际，性能比肩群晖价格 3k 以上的产品，但二手价格仅需十分之一（矿难初期更便宜），可以说是香气四溢了。

蜗牛星际最初也是挖矿大潮中的一员，贴一段官方介绍：

> 「蜗牛星际」一机双挖服务器是由中原硅谷、IPFS 实验室联合开发的一款针对为 IPFS&CAI 城市服务节点提供存储服务的一款专业技术型计算机。它具有稳定、绿色节能、噪音低、操作简单、即插即用、数据处理速度快等特点。
>
> CAI 是一个可扩展、分布式、隐私授权与自我审查的弹性区块链存储基础设施，是第一个支持流媒体大数据存储、直播、分发、增值等服务的公链项目。同时也是全球唯一存储式应用生态，它解决的是区块链 2.0 技术存在的瓶颈。
>
> CAI 立志成为流媒体与大数据领域世界最大的有价数据区块链平台，通过 P2P 网络、超级节点、隐私授权、自我审查等核心技术为用户赋能数据价值；并通过实体通证经济模型实现客户需求与实体企业的数据流通，赋能实体经济。

总之官方吹得神乎其神，还不是骗人挖矿的玩意儿。当时很多矿场高价大量买去挖矿，矿难来临后血本无归，于是低价流入二手市场，成为我们垃圾佬的福音。

硬件上，蜗牛星际有多个版本，区别主要是外观布局、网卡版本和网口数量。其他配置都一样，J1900 CPU，4G 内存，16G mSATA 硬盘，150w 电源和 4 个可抽拉硬盘位（尽管原生 SATA 口只有俩）。计算一下硬件成本，哪怕配件几乎全都是用的山寨货，单一个 NAS 机箱，也值两三百了（NAS 机箱一般都很贵），因此三百多买个 NAS 整机绝对不亏。我入手的是 B 款单千兆网口版本，单网口足够满足我的需求，且 B 款比较好看。

<img src="/what-i-did-in-quarantine-time/snail.jpg" width="500"  title="我的蜗牛星际">

买来以后卖家已经装好了黑群晖系统，省去了我的麻烦。我又买了两块便宜的 3TB 监控硬盘插了进去，成为了一个完整的 NAS。

群晖系统非常用户友好，毕竟是成熟的面向普通用户的系统，完全是傻瓜配置。设置好硬盘文件系统（我没有组 Raid），创建好用户和共享文件夹，就可以在局域网下访问 NAS 里的文件了。在 NAS 上可以安装 Aria 2，并且迅雷在群晖系统中也有下载套件，作为下载器更方便了。同样安装了 Frp 进行内网穿透方便外网访问，并且安装了 Zerotier，建立 P2P 连接，理论上在外网会有更快的访问速度。

这里稍微说明一下，群晖系统本质上也是一个基于 Linux 的系统，只不过经过群晖的高度定制，按照官方应用套件时十分方便。作为 Linux 系统，群晖当然也可以安装各种第三方的应用，只是出于系统稳定性的考虑，第三方应用都推荐使用 Docker 的方式安装，Docker 对于应用环境进行了一定的虚拟化，可以和主系统进行隔离，防止应用出问题而导致主系统出问题。关于群晖的应用玩法，推荐 B 站一个名为「[司波图](https://space.bilibili.com/28457?spm_id_from=333.788.b_765f7570696e666f.1)」的 up 主，他有大量详细的保姆级教程视频，并且也会讲一些原理性的内容，十分适合新手学习。

另外，由于基于更强大的 x86 架构，蜗牛星际的群晖系统可以开虚拟机，我就开了一个虚拟机安装了 OpenWrt 系统，从而将蜗牛星际同时作为软路由使用，于是将 N1 盒子刷成了电视盒子。

关于稳定性的问题我暂时还没有遇到，在家这段时间连续不断电运行了十几天也没有出啥问题，所以虽然都是用的山寨配件，短时间内应该无需太担心。总之这台星际蜗牛让我十分满意，要不是购置硬盘实在太贵了，我很想在学校也再买一台。

## 总结

疫情在家三个多月，学业上可以说全部荒废，但毕竟折腾了这么多硬件，也算是学到了点东西。尽管都是没啥卵用的知识和技能，既然给我带来了这么多乐趣，就不算浪费时间。

何况只要几百块就能折腾这么久，如此廉价的娱乐到哪里去找呢？